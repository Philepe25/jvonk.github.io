<!DOCTYPE html>
<html lang="en-US">
    <head>
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
        <link rel="stylesheet" type="text/css" href="/assets/css/site.css">
        <link rel="stylesheet" type="text/css" href="/assets/css/prism.css"><script type="text/javascript">
            let typeToName = {
                'pas': 'Pascal',
                'cpp': 'C++',
                'java': 'Java'
            }
            function getCode (type) {
                document.getElementById('code').innerHTML+="<div><br>"+(type=='java'?"<h2>CODE</h2>":"")+"<details><summary>"+typeToName[type]+"</summary><pre class = 'line-numbers language-" + (type=='pas'?'pascal':type) +"' data-src='"+"https://raw.githubusercontent.com/jvonk/USACO/master/Chapter_3/msquare/msquare".concat('.'+type)+"'></pre></details></div>";
            }
            document.addEventListener('DOMContentLoaded', function () {
                getCode('java');
                getCode('cpp');
                getCode('pas');
            });
        </script><meta charset="UTF-8"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Magic Squares | Johan Vonk’s Website</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Magic Squares" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="You are to write a program that computes a minimal sequence of basic transformations that transforms the initial configuration of a magic square with colors denoted by the first 8 positive integers to a specific target configuration." />
<meta property="og:description" content="You are to write a program that computes a minimal sequence of basic transformations that transforms the initial configuration of a magic square with colors denoted by the first 8 positive integers to a specific target configuration." />
<link rel="canonical" href="https://jvonk.github.io/usaco/2018/12/11/msquare.html" />
<meta property="og:url" content="https://jvonk.github.io/usaco/2018/12/11/msquare.html" />
<meta property="og:site_name" content="Johan Vonk’s Website" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-12-11T17:00:00-08:00" />
<script type="application/ld+json">
{"url":"https://jvonk.github.io/usaco/2018/12/11/msquare.html","headline":"Magic Squares","dateModified":"2018-12-11T17:00:00-08:00","datePublished":"2018-12-11T17:00:00-08:00","description":"You are to write a program that computes a minimal sequence of basic transformations that transforms the initial configuration of a magic square with colors denoted by the first 8 positive integers to a specific target configuration.","mainEntityOfPage":{"@type":"WebPage","@id":"https://jvonk.github.io/usaco/2018/12/11/msquare.html"},"@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<meta name="google-site-verification" content="a_1tMrUlVNqdFzDGwh_T1IpHoH9qeFrNoVkUBOmi9j0" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#157878">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    </head>
    <body>
        <div class="navbar">
            <a href="https://jvonk.github.io">Home</a><a href="/about/">
                        About
                    </a><div class="dropdown">
                    <button class="dropbtn">
                        USACO</button>
                    <i class="fa fa-caret-down"></i>
                    <div class="dropdown-content"><div class="dropdown">
                                    <button class="dropbtn">CHAPTER 1<i class="fa fa-caret-down"></i>
                                    </button>
                                    <div class="dropdown-content">

        <div class="navbar"><div class="dropdown">
                                                <button class="dropbtn">Section 2<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/09/26/beads.html">beads -Broken Necklace
                                                            </a><a href="/usaco/2018/09/25/friday.html">friday -Friday the 13th
                                                            </a><a href="/usaco/2018/09/25/gift1.html">gift1 -Greedy Gift Givers
                                                            </a><a href="/usaco/2018/09/25/ride.html">ride -Your Ride Is Here
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 3<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/09/28/dualpal.html">dualpal -Dual Palindromes
                                                            </a><a href="/usaco/2018/09/28/palsquare.html">palsquare -Palindromic Squares
                                                            </a><a href="/usaco/2018/09/28/namenum.html">namenum -Name That Number
                                                            </a><a href="/usaco/2018/09/28/transform.html">transform -Transformations
                                                            </a><a href="/usaco/2018/09/27/milk2.html">milk2 -Milking Cows
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 4<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/09/30/skidesign.html">skidesign -Ski Course Design
                                                            </a><a href="/usaco/2018/09/29/wormhole.html">wormhole -Wormholes
                                                            </a><a href="/usaco/2018/09/29/combo.html">combo -Combination Lock
                                                            </a><a href="/usaco/2018/09/29/crypt1.html">crypt1 -Prime Cryptarithm
                                                            </a><a href="/usaco/2018/09/28/milk.html">milk -Mixing Milk
                                                            </a><a href="/usaco/2018/09/28/barn1.html">barn1 -Barn Repair
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 5<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/10/02/milk3.html">milk3 -Mother's Milk
                                                            </a><a href="/usaco/2018/10/01/ariprog.html">ariprog -Arithmetic Progressions
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 6<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/10/04/pprime.html">pprime -Prime Palindromes
                                                            </a><a href="/usaco/2018/10/03/sprime.html">sprime -Superprime Rib
                                                            </a><a href="/usaco/2018/10/03/numtri.html">numtri -Number Triangles
                                                            </a></div>
                                            </div></div>
                                    </div>
                                </div><div class="dropdown">
                                    <button class="dropbtn">CHAPTER 2<i class="fa fa-caret-down"></i>
                                    </button>
                                    <div class="dropdown-content">

        <div class="navbar"><div class="dropdown">
                                                <button class="dropbtn">Section 1<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/10/10/holstein.html">holstein -Healthy Holsteins
                                                            </a><a href="/usaco/2018/10/09/hamming.html">hamming -Hamming Codes
                                                            </a><a href="/usaco/2018/10/08/sort3.html">sort3 -Sorting a Three-Valued Sequence
                                                            </a><a href="/usaco/2018/10/08/castle.html">castle -The Castle
                                                            </a><a href="/usaco/2018/10/05/frac1.html">frac1 -Ordered Fractions
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 2<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/10/12/lamps.html">lamps -Party Lamps
                                                            </a><a href="/usaco/2018/10/12/runround.html">runround -Runaround Numbers
                                                            </a><a href="/usaco/2018/10/11/subset.html">subset -Subset Sums
                                                            </a><a href="/usaco/2018/10/10/preface.html">preface -Preface Numbering
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 3<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/10/17/concom.html">concom -Controlling Companies
                                                            </a><a href="/usaco/2018/10/17/money.html">money -Money Systems
                                                            </a><a href="/usaco/2018/10/15/zerosum.html">zerosum -Zero Sum
                                                            </a><a href="/usaco/2018/10/15/nocows.html">nocows -Cow Pedigrees
                                                            </a><a href="/usaco/2018/10/15/prefix.html">prefix -Longest Prefix
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 4<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/10/31/fracdec.html">fracdec -Fractions to Decimals
                                                            </a><a href="/usaco/2018/10/31/cowtour.html">cowtour -Cow Tours
                                                            </a><a href="/usaco/2018/10/27/comehome.html">comehome -Bessie Come Home
                                                            </a><a href="/usaco/2018/10/22/maze1.html">maze1 -Overfencing
                                                            </a><a href="/usaco/2018/10/22/ttwo.html">ttwo -The Tamworth Two
                                                            </a></div>
                                            </div></div>
                                    </div>
                                </div><div class="dropdown">
                                    <button class="dropbtn">CHAPTER 3<i class="fa fa-caret-down"></i>
                                    </button>
                                    <div class="dropdown-content">

        <div class="navbar"><div class="dropdown">
                                                <button class="dropbtn">Section 1<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/11/06/inflate.html">inflate -Score Inflation
                                                            </a><a href="/usaco/2018/11/05/contact.html">contact -Contact
                                                            </a><a href="/usaco/2018/11/05/humble.html">humble -Humble Numbers
                                                            </a><a href="/usaco/2018/11/03/stamps.html">stamps -Stamps
                                                            </a><a href="/usaco/2018/11/01/agrinet.html">agrinet -Agri-Net
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 2<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2018/12/11/msquare.html">msquare -Magic Squares
                                                            </a><a href="/usaco/2018/12/11/butter.html">butter -Magic Squares
                                                            </a><a href="/usaco/2018/11/15/spin.html">spin -Spinning Wheels
                                                            </a><a href="/usaco/2018/11/14/ratios.html">ratios -Feed Ratios
                                                            </a><a href="/usaco/2018/11/07/kimbits.html">kimbits -Stringsobits
                                                            </a><a href="/usaco/2018/11/07/fact4.html">fact4 -Factorials
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 3<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2019/01/14/game1.html">game1 -A Game
                                                            </a><a href="/usaco/2019/01/12/camelot.html">camelot -Camelot
                                                            </a><a href="/usaco/2018/12/20/shopping.html">shopping -Shopping Offers
                                                            </a><a href="/usaco/2018/12/20/range.html">shopping -Shopping Offers
                                                            </a><a href="/usaco/2018/12/12/fence.html">fence -Riding the Fences
                                                            </a></div>
                                            </div><div class="dropdown">
                                                <button class="dropbtn">Section 4<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2019/01/28/rockers.html">rockers -Raucous Rockers
                                                            </a><a href="/usaco/2019/01/22/fence9.html">fence9 -Electric Fence
                                                            </a><a href="/usaco/2019/01/16/heritage.html">heritage -American Heritage
                                                            </a></div>
                                            </div></div>
                                    </div>
                                </div><div class="dropdown">
                                    <button class="dropbtn">CHAPTER 4<i class="fa fa-caret-down"></i>
                                    </button>
                                    <div class="dropdown-content">

        <div class="navbar"><div class="dropdown">
                                                <button class="dropbtn">Section 1<i class="fa fa-caret-down"></i>
                                                </button>
                                                <div class="dropdown-content"><a href="/usaco/2019/01/28/nuggets.html">nuggets -Beef McNuggets
                                                            </a></div>
                                            </div></div>
                                    </div>
                                </div></div>
                </div><div class="dropdown">
                    <button class="dropbtn">
                        PORTFOLIO</button>
                    <i class="fa fa-caret-down"></i>
                    <div class="dropdown-content"><a href="/portfolio/2018/11/23/overview.html">Overview
                                </a></div>
                </div></div>
        <header class="page-header" role="banner"><h1 class="project-name">
                    Magic Squares</h1>
                    <div class="post-categories"><h2><a href="https://jvonk.github.io#USACO">USACO</a></h2></div><h2 class="project-tagline">
                        You are to write a program that computes a minimal sequence of basic transformations that transforms the initial configuration of a magic square with colors denoted by the first 8 positive integers to a specific target configuration.</h2><a href="https://github.com/jvonk/USACO/blob/master/Chapter_3/msquare/msquare.java" class="btn">Code on GitHub</a><br><a href="https://github.com/jvonk/jvonk.github.io/blob/master/_posts/2018-12-12-msquare.markdown" class="btn">Current Page on GitHub</a></header>
        <main id="content" class="main-content" role="main">
            <div class="realcontent"><a id="skip-to-content" href="#code">Skip to code</a><br><a id="skip-to-content2" href="#analysis">Skip to analysis</a><br><br>
                <em>This is a explanation of this problem from USACO's training website. I have converted it to markdown. Please do not just copy code; you will not learn anything; at least type it out and understand so you can do it yourself in the future!</em><p>Following the success of the magic cube, Mr. Rubik invented its planar version, called magic squares. This is a sheet composed of 8 equal-sized squares:</p>

<pre><code class="language-none">1234
8765
</code></pre>

<p>In this task we consider the version where each square has a different color. Colors are denoted by the first 8 positive integers. A sheet configuration is given by the sequence of colors obtained by reading the colors of the squares starting at the upper left corner and going in clockwise direction. For instance, the configuration of <em>Figure 3</em> is given by the sequence (1,2,3,4,5,6,7,8). This configuration is the initial configuration.</p>

<p>Three basic transformations, identified by the letters ‘A’, ‘B’ and ‘C’, can be applied to a sheet:</p>

<ul>
  <li>‘A’: exchange the top and bottom row,</li>
  <li>‘B’: single right circular shifting of the rectangle,</li>
  <li>‘C’: single clockwise rotation of the middle four squares.</li>
</ul>

<p>Below is a demonstration of applying the transformations to the initial squares given above:</p>

<p><strong>A:</strong></p>

<pre><code class="language-none">8765
1234
</code></pre>

<p><strong>B:</strong></p>

<pre><code class="language-none">4123
5876
</code></pre>

<p><strong>C:</strong></p>

<pre><code class="language-none">1724
8635
</code></pre>

<p>All possible configurations are available using the three basic transformations.</p>

<p>You are to write a program that computes a minimal sequence of basic transformations that transforms the initial configuration above to a specific target configuration.</p>

<h3 id="program-name-msquare">PROGRAM NAME: msquare</h3>

<h3 id="input-format">INPUT FORMAT</h3>

<p>A single line with eight space-separated integers (a permutation of {1..8}) that are the target configuration.</p>

<h3 id="sample-input-file-msquarein">SAMPLE INPUT (file msquare.in)</h3>

<pre><code class="language-none">2 6 8 4 5 7 3 1
</code></pre>

<h3 id="output-format">OUTPUT FORMAT</h3>

<table>
  <tbody>
    <tr>
      <td><strong>Line 1:</strong></td>
      <td>A single integer that is the length of the shortest transformation sequence.</td>
    </tr>
    <tr>
      <td><strong>Line 2:</strong></td>
      <td>The lexically earliest string of transformations expressed as a string of characters, 60 per line except possibly the last line.</td>
    </tr>
  </tbody>
</table>

<h3 id="sample-output-file-msquareout">SAMPLE OUTPUT (file msquare.out)</h3>

<pre><code class="language-none">7
BCABCCB
</code></pre>

<div id="code"></div>
                <script src="/assets/js/prism.js"></script><br>
                <div id="analysis">
                    <h2>ANALYSIS</h2>
<details>
  <summary>
    <p>Hal Burch</p>
  </summary>

  <p>This is a shortest path problem, where the nodes of the graph are board arrangements, and edges are transformations. There are 8! = 40,320 possible board arrangements, so the problem can be solved using breadth-first search (since all edges are of unit length.</p>

  <p>Number the boards in increasing order lexicographically, so that indexing is simpler.</p>

  <p>In order to simplify the calculations, walk the path backward (start at the ending arrangement given, find the minimum path to the initial configuration following reverse transformations). Then, walk backwards in the resulting tree to determine the path.</p>

  <pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;assert.h&gt;

/* the distance from the initial configuration (+1) */
/* dist == 0 =&gt; no know path */
int dist[40320];

/* calculate the index of a board */
int encode(int *board)
 {
  static int mult[8] = 
    {1, 8, 8*7, 8*7*6, 8*7*6*5,
     8*7*6*5*4, 8*7*6*5*4*3, 8*7*6*5*4*3*2};
  
  /* used to calculate the position of a number within the
     remaining ones */
  int look[8] = {0, 1, 2, 3, 4, 5, 6, 7};
  int rlook[8] = {0, 1, 2, 3, 4, 5, 6, 7};
  /* rlook[look[p]] = p and look[rlook[p]] = p */

  int lv, rv;
  int t;

  rv = 0;
  for (lv = 0; lv &lt; 8; lv++)
   {
    t = look[board[lv]]; /* the rank of the board position */
    assert(t &lt; 8-lv); /* sanity check */
    rv += t * mult[lv]; 

    assert(look[rlook[7-lv]] == 7-lv); /* sanity check */

    /* delete t */
    look[rlook[7-lv]] = t;
    rlook[t] = rlook[7-lv];
   }
  return rv;
 }

/* the set of transformations, in order */
static int tforms[3][8] = { {8, 7, 6, 5, 4, 3, 2, 1},
     {4, 1, 2, 3, 6, 7, 8, 5}, {1, 7, 2, 4, 5, 3, 6, 8} };

void do_trans(int *inboard, int *outboard, int t)
 { /* calculate the board (into outboard) that results from doing
      the t'th transformation to inboard */
  int lv;
  int *tform = tforms[t];

  assert(t &gt;= 0 &amp;&amp; t &lt; 3);

  for (lv = 0; lv &lt; 8; lv++)
    outboard[lv] = inboard[tform[lv]-1];
 }

void do_rtrans(int *inboard, int *outboard, int t)
 { /* calculate the board (into outboard) that which would result
      in inboard if the t'th transformation was applied to it */
  int lv;
  int *tform = tforms[t];

  assert(t &gt;= 0 &amp;&amp; t &lt; 3);

  for (lv = 0; lv &lt; 8; lv++)
    outboard[tform[lv]-1] = inboard[lv];
 }

/* queue for breadth-first search */
int queue[40325][8];
int qhead, qtail;

/* calculate the distance from each board to the ending board */
void do_dist(int *board)
 {
  int lv;
  int t1;
  int d, t;

  qhead = 0;
  qtail = 1;

  /* the ending board is 0 steps away from itself */
  for (lv = 0; lv &lt; 8; lv++) queue[0][lv] = board[lv];
  dist[encode(queue[0])] = 1; /* 0 steps (+ 1 offset for dist array) */

  while (qhead &lt; qtail)
   {
    t1 = encode(queue[qhead]);
    d = dist[t1];

    /* for each transformation */
    for (lv = 0; lv &lt; 3; lv++)
     {
      /* apply the reverse transformation */
      do_rtrans(queue[qhead], queue[qtail], lv);

      t = encode(queue[qtail]);
      if (dist[t] == 0) 
       { /* found a new board position!  add it to queue */
        qtail++;
        dist[t] = d+1;
       }
     }

    qhead++;
   }
 }

/* find the path from the initial configuration to the ending board */
void walk(FILE *fout)
 {
  int newboard[8];
  int cboard[8];
  int lv, lv2;
  int t, d;

  for (lv = 0; lv &lt; 8; lv++) cboard[lv] = lv;
  d = dist[encode(cboard)];
  /* start at the ending board */
  while (d &gt; 1)
   {
    for (lv = 0; lv &lt; 3; lv++)
     {
      do_trans(cboard, newboard, lv);
      t = encode(newboard);
      if (dist[t] == d-1) /* we found the previous board! */
       {
        /* output transformatino */
        fprintf (fout, "%c", lv+'A');

	/* find the rest of the path */
        for (lv2 = 0; lv2 &lt; 8; lv2++) cboard[lv2] = newboard[lv2];
	break;
       }
     }
    assert(lv &lt; 3);
    d--;
   }
  fprintf (fout, "\n");
 }

int main(int argc, char **argv)
 {
  FILE *fout, *fin;
  int board[8];
  int lv;

  if ((fin = fopen("msquare.in", "r")) == NULL)
   {
    perror ("fopen fin");
    exit(1);
   }
  if ((fout = fopen("msquare.out", "w")) == NULL)
   {
    perror ("fopen fout");
    exit(1);
   }

  for (lv = 0; lv &lt; 8; lv++) 
   {
    fscanf (fin, "%d", &amp;board[lv]);
    board[lv]--; /* use 0-based instead of 1-based */
   }

  /* calculate the distance from each board to the ending board */
  do_dist(board);

  for (lv = 0; lv &lt; 8; lv++) board[lv] = lv;

  /* output the distance from and the path from the initial configuration */
  fprintf (fout, "%d\n", dist[encode(board)]-1);
  walk(fout);

  return 0;
 }
</code></pre>

</details>

</div><br>
                <a id="skip-to-main" href="#content">Back to top</a></div><footer class="site-footer realcontent"><span class="site-footer-owner"><a href="https://github.com/jvonk/USACO/blob/master/Chapter_3/msquare/msquare.java">USACO - msquare</a>
                            is created by
                            <a href="http://github.com/jvonk">
                                jvonk</a>
                            .
                        </span></footer></main>
    </body>
</html>
